## Nested Class (중첩 클래스)
- 클래스 안에 클래스를 중첩하여 정의한 것

### 종류

* * *

> 중첩 : 어떤 것이 다른 것의 내부에 위치하거나 포함되는 구조적 관계  
> 내부 : 어떤 것이 다른 것을 구성하는 요소인 관계

- 정적 중첩 클래스 (`static`)
    - 바깥 클래스와 전혀 관계 없는 전혀 다른 클래스이다.   
      =**바깥 클래스의 인스턴스에 소속되지 않는다.**
    - 바깥 클래스의 클래스 멤버에는 접근 가능하지만, 인스턴스 멤버에는 접근할 수 없다.
    - `private`클래스 멤버의 경우에도 접근이 가능하다.
    - 바깥의 인스턴스 멤버에 접근이 필요하지 않으면,`static`클래스로 선언한다.
    - `{외부 클래스명}.{중첩 클래스명}()`을 통해 생성한다.
        ```java
        OuterClass.NestedClass nested = new OuterClass.NestedClass();
        ```
        - 다른 클래스에서 중첩 클래스에 접근한다면 위와 같이 생성하지만, 이미 그렇게 외부에서 접근해야 한다는 것부터 잘못된 것일 수 있다.
        - 내부에서 중첩 클래스에 접근할 때는 해당 클래스 이름만으로 접근이 가능하다.

- 내부 클래스들
    - 바깥 클래스의 내부에 있으면서 바깥 클래스를 구성하는 요소이다.\=**바깥 클래스의 인스턴스에 소속된다.**
    - `private`클래스/인스턴스 멤버의 경우에도 접근이 가능하다.
    - 같은 변수명을 가진 경우
        - 나의 인스턴스 변수 :`this.{변수명}`
        - 바깥 인스턴스 변수 :`{바깥 클래스명}.this.{변수명}`
    - 내부 클래스
        - 바깥 클래스의 클래스/인스턴스 멤버에 접근 가능
        - `{외부 클래스명}.new {내부 클래스명}()`을 통해 생성한다.

        ```java
        OuterClass.InnerClass inner = new OuterClass.new
        InnerClass();
        ```
        - 바깥 인스턴스 없이 단독으로 생성될 수 없다.
        - 어떤 인스턴스 내부에 만들어 질 것 인가에 대한 참조가 필요하기 때문이다.
        - 개념상 바깥 인스턴스 내부에 내부 인스턴스가 생성된다.
        - 실제 메모리 상에서는 각각 생성되고, 내부 인스턴스는 바깥 인스턴스의 참조값을 보관하고이 값을 통해 바깥 인스턴스의 멤버에 접근할 수 있다.

    - 지역 클래스
        - 내부 클래스의 특징 + 지역 변수에 접근 가능
        - 클래스의 메서드 내부에 존재하는 클래스이다.
        - 지역 변수와 같이 접근 제어자를 설정할 수 없다.
        - 메서드 안에서 생성된다.

        ```java
        public void outerMethod() {
            class LocalInnerClass {
            }
            LocalInnerClass local = new LocalInnerClass();
        }
        ```
    - 지역 변수 캡쳐
        - 메서드는 스택 영역에 실행시에 생성되고, 끝나면 제거된다.
        - 메서드 안에서 생성된 인스턴스는 참조하고 있는 값이 있다면 GC 전까지 살아남는다.
        - 메서드의 생명주기가 인스턴스의 생명주기보다 짧다.
        - 메서드가 종료되고 인스턴스에서 지역변수를 호출하게되면 이미 지역변수들은 사라지고 난 상태인데 어떻게 호출이 가능할까?
            - 자바가 인스턴스를 생성할 때 자동으로 필요한 지역변수를 복사하여 생성한 인스턴스에 함께 저장하기 때문에 가능하다.
            - 모든 지역변수를 캡쳐하는 것이 아니라, 접근이 필요한 변수만 캡쳐한다.
            - 결국 인스턴스 안에서 지역변수를 호출하는 것이 아니라, 자신 안에 저장된 변수를 호출하는 것이다.
        - 지역 변수의 값이 변해버리면?
            - 지역 클래스가 호출하는 지역 변수의 값은 절대로 값이 변하면 안된다. (자바의 규칙, 변경하면 컴파일 오류 발생)
            - `final`로 선언하던지, 선언하지 않더라도 값을 변경하면 안된다. (effectively final, 사실상 final)
            - 인스턴스 생성시에 지역변수를 캡쳐하기 때문에, 생성 이후에 값을 변경하면 동기화 문제가 발생한다.
            - 예상치 못한 곳에서 값이 변경할 수 있어 디버깅을 어렵게 한다.
            - 멀티스레드의 상황에서는 이런 동기화 작업이 매우 어렵고 성능에 안좋은 영향을 끼칠 수 있다.

    - 익명 클래스
        - 지역 클래스의 특징 + 클래스의 이름이 없음
        - 지역 클래스의 종류 중의 하나이다.
        - 클래스의 선언과 생성을 한 번에 처리할 수 있다.
            ```java
            public void outerMethod() {
                Parent anonymous = new Parent() {
                };
            }
            ```
        - 부모 클래스를 상속 받거나, 인터페이스를 구현한 클래스를 정의하는 것이다.
        - 상위 클래스가 반드시 필요하다.
        - 생성자를 가질 수 없다.
        - 이름이 없기 때문에`바깥 클래스의 이름 + $ + 숫자`로 정의된다.
        - 익명 클래스는 단 한번만 인스턴스를 생성할 수 있다.
            - 여러 인스턴스가 필요한 경우, 일반적인 지역 클래스로 정의하고 사용해야 한다.
        - 람다 (lambda)
            - 자바 8 이전까지는 메서드에 인수로 전달할 수 있는 것은 크게 2가지였다.
                - 기본형 타입 변수
                - 참조형 타입 변수
            - 코드 조각(메서드)을 인수로 넘기고 싶었다.
            - 자바 8 이후 메서드(함수)를 인수로 전달할 수 있게 되었다.

### 사용

* * *

- 특정 클래스가 다른 하나의 클래스 안에서만 사용하거나, 긴밀하게 연결되어 있는 경우에만 사용해야 한다.
    - 논리적 그룹화
    - 캡슐화
        - 내부에서 private 멤버에 접근이 가능하기 때문에, 불필요하게 변수/메서드를 노출할 필요가 없어진다.
- 외부에서 중첩 클래스에 접근한다면, 사용하면 안된다.